<atlassian-plugin key="${atlassian.plugin.key}" name="${project.name}" plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <version>${project.version}</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}" />
        <param name="plugin-icon">images/cf-icon.png</param>
        <param name="plugin-logo">images/cf-logo.png</param>
    </plugin-info>

    <!-- add our i18n resource -->
    <resource type="i18n" name="i18n" location="bitbucket-plugin"/>
    
	<web-resource key="webResources">
		<resource type="download" name="override.css" location="/css/override.css"/>
		<context>bitbucket.page.errors</context>
	</web-resource>
    
    <servlet-filter name="Cloudflare Access Auth Filter" key="cloudflareAccessAuthFilter" 
    				class="com.cloudflare.access.atlassian.bitbucket.auth.CloudflareAccessAuthenticationFilter" 
    				location="before-login" weight="200">
        <description>Check authentication headers</description>
        <url-pattern>/*</url-pattern>
        <dispatcher>REQUEST</dispatcher>
        <dispatcher>FORWARD</dispatcher>
    </servlet-filter>

    <servlet-filter name="Cloudflare Access Logout Filter" key="cloudflareAccessLogoutFilter" 
    				class="com.cloudflare.access.atlassian.bitbucket.auth.CloudflareAccessLogoutFilter" 
    				location="before-login" weight="100">
        <description>Intercepts logout calls and logout user from Cloudflare Access</description>
        <url-pattern>/logout</url-pattern>
        <dispatcher>REQUEST</dispatcher>
        <dispatcher>FORWARD</dispatcher>
    </servlet-filter>
    
    <http-auth-handler key="containerAuthenticationHandler"
                       class="bean:cloudflareAccessAuthenticationHandler"
                       weight="100"/>

    <http-auth-success-handler key="containerAuthenticationSuccessHandler"
                       class="bean:cloudflareAccessAuthenticationHandler"
                       weight="50"/>
    
</atlassian-plugin>