<atlassian-plugin key="${atlassian.plugin.key}" name="${project.name}" plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <version>${project.version}</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}" />
        <param name="plugin-icon">images/cf-icon.png</param>
        <param name="plugin-logo">images/cf-logo.png</param>
    </plugin-info>

    <servlet-filter name="Cloudflare Access Auth Filter" key="cloudflareAccessAuthFilter" 
    				class="com.cloudflare.access.atlassian.jira.auth.CloudflareAccessAuthenticationFilter" 
    				location="before-login" weight="200">
        <description>Check authentication headers</description>
        <url-pattern>/*</url-pattern>
        <dispatcher>REQUEST</dispatcher>
        <dispatcher>FORWARD</dispatcher>
    </servlet-filter>

    <servlet-filter name="Cloudflare Access Logout Filter" key="cloudflareAccessLogoutFilter" 
    				class="com.cloudflare.access.atlassian.jira.auth.CloudflareAccessLogoutFilter" 
    				location="before-login" weight="100">
        <description>Intercepts logout calls and logout user from Cloudflare Access</description>
        <url-pattern>/logout</url-pattern>
        <dispatcher>REQUEST</dispatcher>
        <dispatcher>FORWARD</dispatcher>
    </servlet-filter>
    
    <resource type="i18n" name="i18n" location="pluginMessages"/>
    
	<servlet name="Cloudflare Access Configuration Servlet" key="cloudflareAccessConfigServlet" class="com.cloudflare.access.atlassian.base.config.ConfigurationServlet">
	  <description>Servlet to process configuration requests</description> 
	  <url-pattern>/cloudflareaccess/config</url-pattern>
	</servlet>
	
	<web-item name="Cloudflare Access Configuration Link" key="cloudflareAccessConfigMenuItem" 
				section="top_system_section/security_section" 
				weight="70" >
	  <description>Link to Cloudflare Access Configuration page.</description> 
	  <label>Cloudflare Access</label> 
	  <link linkId="cloudflareAccessConfigLink">/plugins/servlet/cloudflareaccess/config</link> 
	</web-item> 
</atlassian-plugin>